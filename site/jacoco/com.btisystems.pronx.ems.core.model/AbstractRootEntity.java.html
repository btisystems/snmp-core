<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AbstractRootEntity.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">snmp-core</a> &gt; <a href="index.source.html" class="el_package">com.btisystems.pronx.ems.core.model</a> &gt; <span class="el_source">AbstractRootEntity.java</span></div><h1>AbstractRootEntity.java</h1><pre class="source lang-java linenums">/*
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.btisystems.pronx.ems.core.model;

import com.btisystems.pronx.ems.core.exception.FieldAccessMethodException;
import com.btisystems.pronx.ems.core.exception.InvalidFieldNameException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.snmp4j.smi.OID;

import java.lang.reflect.Method;

/**
 * Abstract class to be extended by the root entity for each device type.
 */
<span class="fc" id="L28">public abstract class AbstractRootEntity extends DeviceEntity implements IObjectSetter {</span>

<span class="fc" id="L30">    private static Logger log = LoggerFactory.getLogger(AbstractRootEntity.class);</span>

    @SuppressWarnings(&quot;unused&quot;)
    private int id;
    private String deviceAddress;

    /**
     * Gets id.
     *
     * @return the id
     */
    public int getId() {
<span class="nc" id="L42">        return id;</span>
    }

    /**
     * Gets device address.
     *
     * @return the device address
     */
    public String getDeviceAddress() {
<span class="fc" id="L51">        return deviceAddress;</span>
    }

    /**
     * Sets device address.
     *
     * @param deviceAddress the device address
     */
    public void setDeviceAddress(final String deviceAddress) {
<span class="fc" id="L60">        this.deviceAddress = deviceAddress;</span>
<span class="fc" id="L61">    }</span>

    /**
     * Is entity supported boolean.
     *
     * @param fieldName the field name
     * @return the boolean
     */
    public boolean isEntitySupported(final String fieldName) {
<span class="fc" id="L70">        boolean result = true;</span>
        try {
<span class="fc" id="L72">            this.getClass().getMethod(getGetterName(fieldName));</span>
<span class="fc" id="L73">        } catch (final NoSuchMethodException ex) {</span>
<span class="fc" id="L74">            log.trace(&quot;No such field on class {}: {}&quot;, this.getClass().getName(), fieldName, ex);</span>
<span class="fc" id="L75">            result = false;</span>
<span class="fc" id="L76">        }</span>
<span class="fc" id="L77">        return result;</span>
    }

    /**
     * Returns the entity with the specified OID.
     *
     * @param oid the OID of the entity to be returned
     * @return the {@link DeviceEntity} with the specified oid, which may be &lt;code&gt;null&lt;/code&gt;          if the entity has not been instantiated, or if the oid is not registered for          the device.
     */
    public DeviceEntity getEntity(final OID oid) {
<span class="fc bfc" id="L87" title="All 2 branches covered.">        for (final DeviceEntity root : getRoots()) {</span>
<span class="fc bfc" id="L88" title="All 6 branches covered.">            if (root != null &amp;&amp; root.get_Description() != null</span>
                    &amp;&amp; oid.equals(root.get_Description().getOid())) {
<span class="fc" id="L90">                return root;</span>
            }
        }
<span class="fc" id="L93">        return null;</span>
    }

    /**
     * Return the root objects for the device
     *
     * @return an array of {@link DeviceEntity}s each of which is a root of a          hierarchy of entities supported by the device
     */
    public abstract DeviceEntity[] getRoots();

    /**
     * Gets entity.
     *
     * @param fieldName the field name
     * @return the entity
     */
    public DeviceEntity getEntity(final String fieldName) {
        try {
<span class="fc" id="L111">            final Method method = this.getClass().getMethod(getGetterName(fieldName));</span>
<span class="fc" id="L112">            return (DeviceEntity) method.invoke(this, (Object[]) null);</span>
<span class="fc" id="L113">        } catch (final NoSuchMethodException e) {</span>
<span class="fc" id="L114">            log.warn(&quot;Unrecognised field name:{}&quot;, fieldName);</span>
<span class="fc" id="L115">            log.trace(&quot;Exception:&quot;, e);</span>
<span class="fc" id="L116">            throw new InvalidFieldNameException(this, fieldName);</span>
<span class="nc" id="L117">        } catch (final Exception e) {</span>
<span class="nc" id="L118">            log.warn(&quot;Exception on get&quot;, e);</span>
<span class="nc" id="L119">            throw new FieldAccessMethodException(this, fieldName, e.getMessage());</span>
        }
    }

    @Override
    public DeviceEntityDescription get_Description() {
<span class="fc" id="L125">        return null;</span>
    }    @SuppressWarnings({&quot;rawtypes&quot;})
    @Override
    public void setObject(final Class clazz, final Object childObject) {
<span class="fc" id="L129">        String sn = null;</span>
        try {
<span class="fc" id="L131">            sn = clazz.getSimpleName();</span>
<span class="fc" id="L132">            final Method method = this.getClass().getMethod(getSetterName(sn), clazz);</span>
<span class="fc" id="L133">            method.invoke(this, childObject);</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">            if (childObject != null) {</span>
<span class="fc" id="L135">                ((DeviceEntity) childObject).set_ParentEntity(this);</span>
            }
<span class="fc" id="L137">        } catch (final NoSuchMethodException e) {</span>
<span class="fc" id="L138">            log.warn(&quot;No such method in setObject. SimpleName:&quot; + sn, e);</span>
<span class="fc" id="L139">            throw new InvalidFieldNameException(this, clazz.getSimpleName());</span>
<span class="nc" id="L140">        } catch (final Exception e) {</span>
<span class="nc" id="L141">            log.warn(&quot;Exception in setObject. SimpleName:&quot; + sn, e);</span>
<span class="nc" id="L142">            throw new FieldAccessMethodException(this, sn, e.getMessage());</span>
<span class="fc" id="L143">        }</span>
<span class="fc" id="L144">    }</span>

    /**
     * Gets object.
     *
     * @param clazz the clazz
     * @return the object
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public Object getObject(final Class clazz) {
<span class="fc" id="L154">        String sn = null;</span>
        try {
<span class="fc" id="L156">            sn = clazz.getSimpleName();</span>
<span class="fc" id="L157">            final Method method = this.getClass().getMethod(getGetterName(sn));</span>
<span class="fc" id="L158">            final Object obj = method.invoke(this);</span>
<span class="fc" id="L159">            return obj;</span>
<span class="fc" id="L160">        } catch (final NoSuchMethodException e) {</span>
<span class="fc" id="L161">            log.warn(&quot;No such method in getObject. SimpleName:&quot; + clazz.getSimpleName(), e);</span>
<span class="fc" id="L162">            throw new InvalidFieldNameException(this, clazz.getSimpleName());</span>
<span class="nc" id="L163">        } catch (final Exception e) {</span>
<span class="nc" id="L164">            log.warn(&quot;Exception in setObject. SimpleName:&quot; + sn, e);</span>
<span class="nc" id="L165">            throw new FieldAccessMethodException(this, sn, e.getMessage());</span>
        }
    }    @Override
    public void setObject(final Object childObject) {
<span class="fc" id="L169">        setObject(childObject.getClass(), childObject);</span>
<span class="fc" id="L170">    }</span>

    /**
     * Create entity device entity.
     *
     * @param entityName the entity name
     * @return the device entity
     */
    public DeviceEntity createEntity(final String entityName) {
<span class="fc" id="L179">        final Class&lt;? extends DeviceEntity&gt; clazz = getEntityType(entityName);</span>

<span class="fc" id="L181">        final DeviceEntity entity = instantiateObject(clazz);</span>
<span class="fc" id="L182">        setObject(clazz, entity);</span>
<span class="fc" id="L183">        return entity;</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    private Class&lt;? extends DeviceEntity&gt; getEntityType(final String entityName) {
        try {
<span class="fc" id="L189">            return (Class&lt;? extends DeviceEntity&gt;) this.getClass().getMethod(getGetterName(entityName)).getReturnType();</span>
<span class="nc" id="L190">        } catch (final SecurityException e) {</span>
<span class="nc" id="L191">            log.warn(&quot;SecurityException on getEntityType&quot;, e);</span>
<span class="nc" id="L192">            throw new FieldAccessMethodException(this, entityName, e.getMessage());</span>
<span class="fc" id="L193">        } catch (final NoSuchMethodException e) {</span>
<span class="fc" id="L194">            log.warn(&quot;Exception on getEntityType&quot;, e);</span>
<span class="fc" id="L195">            throw new InvalidFieldNameException(this, entityName);</span>
        }
    }

    // Instantiates an object of a given class.
    private DeviceEntity instantiateObject(final Class&lt;? extends DeviceEntity&gt; clazz) {
<span class="fc" id="L201">        DeviceEntity object = null;</span>
        try {
<span class="fc" id="L203">            object = clazz.newInstance();</span>
<span class="nc" id="L204">        } catch (final InstantiationException e) {</span>
<span class="nc" id="L205">            log.warn(&quot;Failed to instantiate object of type: &quot; + clazz, e);</span>
<span class="nc" id="L206">        } catch (final IllegalAccessException e) {</span>
<span class="nc" id="L207">            log.warn(&quot;Failed to access object of type : &quot; + clazz, e);</span>
<span class="pc" id="L208">        }</span>
<span class="fc" id="L209">        return object;</span>
    }




}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>